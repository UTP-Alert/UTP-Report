<h2 class="text-2xl mb-4 flex items-center gap-3">
	<i class="alert-circle-icon h-8 w-8 text-purple-600"></i>
	Reportes Pendientes de Aprobaci√≥n ({{ reportes.length }})
</h2>

<div *ngIf="loading" class="card border-2 border-dashed border-gray-300">
	<div class="card-content p-12 text-center">
		<i class="alert-circle-icon h-16 w-16 text-gray-400 mx-auto mb-4"></i>
		<h3 class="text-xl mb-2 text-gray-600">Cargando reportes...</h3>
	</div>
</div>

<div *ngIf="!loading && reportes.length === 0" class="card border-2 border-dashed border-gray-300">
	<div class="card-content p-12 text-center">
		<i class="alert-circle-icon h-16 w-16 text-gray-400 mx-auto mb-4"></i>
		<h3 class="text-xl mb-2 text-gray-600">No hay reportes pendientes de aprobaci√≥n</h3>
		<p class="text-gray-500 mb-6">Todos los reportes han sido revisados y aprobados o rechazados.</p>
		<span class="badge badge-outline px-4 py-2">‚úÖ Estado: Todo al d√≠a</span>
	</div>
</div>

	<div *ngFor="let r of reportes" class="card border-l-4 border-l-purple-500 bg-purple-50 hover:shadow-lg transition-all mb-4">
	<div class="card-content p-4">

		<!-- pending badge top-right -->
		<span class="badge pending top-right">PENDIENTE APROBACI√ìN</span>

		<div class="flex justify-between items-start mb-2">
			<h3 class="text-base sm:text-lg font-semibold">{{ tiposMap[r.tipoIncidenteId] || ('Reporte') }}</h3>
			<div class="flex gap-2 items-center">
				<span class="badge priority" [ngClass]="{'high': (r.ultimaPrioridad||'')==='alta','medium': (r.ultimaPrioridad||'')==='media','low': (r.ultimaPrioridad||'')==='baja'}">{{ (r.ultimaPrioridad||'') | uppercase }}</span>
			</div>
		</div>
		<div class="flex items-center gap-2 text-sm text-gray-600 mb-2">
			<i class="map-pin-icon h-4 w-4"></i>
			<span>{{ zonasMap[r.zonaId] || (r.zonaId ? ('Zona ' + r.zonaId) : 'Sin zona') }}</span>
			<span>‚Ä¢</span>
			<span>Completado: {{ (r.reporteGestion && r.reporteGestion.fechaActualizacion) ? (r.reporteGestion.fechaActualizacion | date:'short') : (r.fechaUltimaGestion ? (r.fechaUltimaGestion | date:'short') : (r.fechaCreacion | date:'short')) }}</span>
			<span>‚Ä¢</span>
			<span>ID: {{ r.id }}</span>
		</div>

		<!-- Moved: Ver foto + miniatura placed under meta info as requested -->
		<div *ngIf="getImageSrc(r) as img" style="display:flex;align-items:center;gap:8px;margin-top:12px">
			<button class="action-btn" (click)="openImage(img)">üì∑ Ver foto</button>
			<img [src]="img" class="inline-thumb" alt="Evidencia" (click)="openImage(img)" />
		</div>
		<p class="text-gray-700 mb-4">Incidente de seguridad resuelto, pendiente de aprobaci√≥n final.</p>

		<div class="parte-box mb-4">
			<h4 class="parte-title">Parte de Seguridad - Descripci√≥n de Resoluci√≥n</h4>
			<div class="parte-content">{{ r.mensajeSeguridad }}</div>
			<div class="parte-meta">Completado: {{ (r.reporteGestion && r.reporteGestion.fechaActualizacion) ? (r.reporteGestion.fechaActualizacion | date:'short') : (r.fechaUltimaGestion ? (r.fechaUltimaGestion | date:'short') : (r.fechaCreacion | date:'short')) }}</div>
		</div>

		<div class="bg-gray-50 p-3 rounded-lg text-sm mb-4">
			<p class="text-gray-600">Asignado a: <span class="font-medium">Equipo de Seguridad</span></p>
			<p class="text-gray-600">Fecha de asignaci√≥n: <span class="font-medium">{{ r.fechaCreacion | date:'short' }}</span></p>
		</div>

		<div class="flex justify-end gap-2 actions-row">
			<button class="btn btn-review" (click)="openReview(r)">Revisar y Decidir</button>
		</div>
	</div>
</div>

<!-- Review Modal -->
<div *ngIf="selectedForReview" class="modal-overlay">
	<div class="modal-card">
		<div class="modal-header">
			<h3>Revisar Resoluci√≥n del Reporte</h3>
			<button class="close-x" (click)="closeReview()">‚úï</button>
		</div>
		<div class="modal-body">
			<div class="info-box">
				<p><strong>Tipo:</strong> {{ tiposMap[selectedForReview.tipoIncidenteId] || '---' }}</p>
				<p><strong>Ubicaci√≥n:</strong> {{ zonasMap[selectedForReview.zonaId] || '---' }}</p>
				<p><strong>Descripci√≥n Original:</strong> {{ selectedForReview.descripcion }}</p>
				<p><strong>ID:</strong> {{ selectedForReview.id }}</p>
			</div>

			<div class="parte-box" style="margin-top:12px">
				<h4 class="parte-title">Parte de Seguridad</h4>
				<div class="parte-content">{{ selectedForReview.mensajeSeguridad }}</div>
				<div class="parte-meta" style="margin-top:8px">Oficial: <strong>Equipo de Seguridad</strong></div>
			</div>

			<label class="label" style="display:block; margin-top:12px">Comentario de Aprobaci√≥n (Obligatorio)</label>
			<textarea class="input" [(ngModel)]="adminComment" rows="4" placeholder="Agregue comentarios sobre la resoluci√≥n del caso..." required></textarea>
			<div *ngIf="!adminComment || (adminComment && adminComment.trim().length === 0)" style="color:#ef4444; font-size:13px; margin-top:6px">Debe ingresar un comentario para poder Aprobar o Rechazar.</div>
		</div>
		<div class="modal-footer">
			<button class="btn" (click)="closeReview()">Cancelar</button>
			<button class="btn btn-reject" (click)="rejectSelected()" [disabled]="!adminComment || (adminComment && adminComment.trim().length === 0)">Rechazar y Devolver</button>
			<button class="btn btn-approve" (click)="approveSelected()" [disabled]="!adminComment || (adminComment && adminComment.trim().length === 0)">Aprobar y Marcar como Resuelto</button>
		</div>
	</div>
</div>

		<!-- Image preview modal (Pend. Aprobaci√≥n) - overlay fixed; click backdrop to close -->
		<div *ngIf="imageModalVisible" class="modal-overlay" (click)="closeImage()" style="position:fixed; left:0; top:0; right:0; bottom:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.45); z-index:9999;">
			<div class="modal-card" style="position:relative; z-index:10000; max-width:920px; width:auto; display:inline-block; padding:0;">
				<img [src]="selectedImageSrc" alt="Evidencia" (click)="$event.stopPropagation()" style="max-width:100%; max-height:80vh; border-radius:8px; display:block; margin:0;" />
			</div>
		</div>
