<!-- Modal de re-autenticaciÃ³n para acceder a reportes sensibles -->
<div *ngIf="showAuthModal" class="modal-backdrop">
	<div class="modal-card">
		<button class="modal-close" (click)="cancelAuth()">âœ•</button>
		<h3>Acceso a Reportes Sensibles</h3>
		<p class="muted">Esta secciÃ³n contiene informaciÃ³n confidencial de todos los reportes. Se requiere autenticaciÃ³n adicional.</p>

		<div class="alert alert-info">ðŸ”’ Solo el SuperAdmin puede acceder a esta informaciÃ³n sensible.</div>

		<label class="block text-sm font-medium mt-3">ContraseÃ±a de Acceso Sensible</label>
		<input type="password" placeholder="Ingrese la contraseÃ±a especial" [(ngModel)]="passwordInput" class="input-field" />
		<p *ngIf="authError" class="text-xs text-red-500 mt-2">{{ authError }}</p>

		<div class="modal-actions">
			<button class="btn btn-primary" (click)="submitAuth()" [disabled]="loadingAuth">
				<span *ngIf="!loadingAuth">ðŸ”’ Autenticar</span>
				<span *ngIf="loadingAuth">Validando...</span>
			</button>
			<button class="btn btn-outline" (click)="cancelAuth()" [disabled]="loadingAuth">Cancelar</button>
		</div>
	</div>
</div>

<!-- Contenido sensible: solo visible si accesoConcedido -->
<div *ngIf="accesoConcedido" class="sensitive-area">
	<div class="header-row">
		<h2>Panel de Reportes Sensibles</h2>
		<button class="btn btn-outline" (click)="loadReports()">Actualizar</button>
	</div>

	<!-- Banner superior y tarjetas de mÃ©tricas (igualito al mock) -->
	<div class="top-banner">
		<div class="banner-inner">
			<div class="banner-left">
				<div class="banner-title">Reportes Sensibles</div>
				<div class="banner-sub">- Acceso a informaciÃ³n confidencial y identidad real de todos los reportes.</div>
			</div>
			<div class="banner-right">
				<button class="btn btn-outline" (click)="closeSensitiveSession()">
					<!-- Lock icon -->
					<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="width:16px;height:16px;margin-right:8px;">
						<rect x="3" y="11" width="18" height="11" rx="2"></rect>
						<path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
					</svg>
					Cerrar SesiÃ³n Sensible
				</button>
			</div>
		</div>
	</div>

	<div class="stats-row">
		<div class="stat-card card-1">
			<div class="stat-icon">
				<!-- Tabler file icon -->
				<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-file" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
					<path stroke="none" d="M0 0h24v24H0z" fill="none"/>
					<path d="M14 3v4a1 1 0 0 0 1 1h4" />
					<path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" />
				</svg>
			</div>
			<div class="stat-body">
				<div class="stat-number">{{ totalReports }}</div>
				<div class="stat-label">Total Reportes</div>
			</div>
		</div>
		<div class="stat-card card-2">
			<div class="stat-icon">
				<!-- Tabler eye icon -->
				<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-eye" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
					<path stroke="none" d="M0 0h24v24H0z" fill="none"/>
					<path d="M2 12s4 -7 10 -7 10 7 10 7 -4 7 -10 7 -10 -7 -10 -7" />
					<circle cx="12" cy="12" r="3" />
				</svg>
			</div>
			<div class="stat-body">
				<div class="stat-number">{{ identificadosCount }}</div>
				<div class="stat-label">Identificados</div>
			</div>
		</div>
		<div class="stat-card card-3">
			<div class="stat-icon">
				<!-- Tabler eye-off icon (inline for crisp rendering) -->
				<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-eye-off" aria-hidden="true">
					<path stroke="none" d="M0 0h24v24H0z" fill="none"/>
					<path d="M10.585 10.587a2 2 0 0 0 2.829 2.828" />
					<path d="M16.681 16.673a8.717 8.717 0 0 1 -4.681 1.327c-3.6 0 -6.6 -2 -9 -6c1.272 -2.12 2.712 -3.678 4.32 -4.674m2.86 -1.146a9.055 9.055 0 0 1 1.82 -.18c3.6 0 6.6 2 9 6c-.666 1.11 -1.379 2.067 -2.138 2.87" />
					<path d="M3 3l18 18" />
				</svg>
			</div>
			<div class="stat-body">
				<div class="stat-number">{{ anonimosCount }}</div>
				<div class="stat-label">AnÃ³nimos</div>
			</div>
		</div>
		<div class="stat-card card-4">
			<div class="stat-icon">
				<!-- Tabler alert-triangle icon -->
				<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-alert-triangle" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
					<path stroke="none" d="M0 0h24v24H0z" fill="none"/>
					<path d="M10.29 3.86l-8.47 14.14a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3l-8.47-14.14a2 2 0 0 0-3.42 0z" />
					<path d="M12 9v4" />
					<circle cx="12" cy="17" r="1" />
				</svg>
			</div>
			<div class="stat-body">
				<div class="stat-number">{{ altaPrioridadCount }}</div>
				<div class="stat-label">Alta Prioridad</div>
			</div>
		</div>
		<div class="stat-card card-5">
			<div class="stat-icon">
				<!-- User with check icon (reemplazado por Tabler icon provided) -->
				<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-user-check" aria-hidden="true"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0" /><path d="M6 21v-2a4 4 0 0 1 4 -4h4" /><path d="M15 19l2 2l4 -4" /></svg>
			</div>
			<div class="stat-body">
				<div class="stat-number">{{ uniqueUsersCount }}</div>
				<div class="stat-label">Usuarios Ãšnicos</div>
			</div>
		</div>
	</div>

	<!-- filtros simples -->
	<div class="filters">
		<input type="text" placeholder="Buscar usuario, email, descripciÃ³n..." [(ngModel)]="searchText" class="input-field" />
		<select [(ngModel)]="selectedEstado" class="select-field">
			<option value="all">Todos</option>
			<option value="PENDIENTE">Pendiente</option>
			<option value="INVESTIGANDO">Investigando</option>
			<option value="EN_PROCESO">En proceso</option>
			<option value="RESUELTO">Resuelto</option>
			<option value="CANCELADO">Cancelado</option>
		</select>
		<select [(ngModel)]="selectedPrioridad" class="select-field">
			<option value="all">Todas</option>
			<option value="ALTA">Alta</option>
			<option value="MEDIA">Media</option>
			<option value="BAJA">Baja</option>
		</select>
		<select [(ngModel)]="selectedTipo" class="select-field">
			<option value="all">Todos</option>
			<option *ngFor="let t of tipos" [value]="t.id">{{ t.nombre }}</option>
		</select>

		<!-- Botones adicionales: Limpiar y Exportar -->
		<div class="filter-actions">
			<button class="btn btn-outline" (click)="clearFilters()">Limpiar</button>
			<button class="btn btn-primary" (click)="exportToExcel()">Exportar</button>
		</div>
	</div>

	<div class="report-list">
		<div *ngIf="!reports || reports.length === 0" class="empty">No hay reportes sensibles.</div>
			<div *ngFor="let r of filteredReports" class="report-card">
				<div class="card-header">
					<div class="badges">
						<span class="badge priority" *ngIf="r.reporteGestion && r.reporteGestion.prioridad">{{ r.reporteGestion.prioridad }}</span>
						<span class="badge estado">{{ (r.reporteGestion && r.reporteGestion.estado) ? r.reporteGestion.estado : (r.ultimoEstado || '') }}</span>
						<span class="badge tipo">{{ (r.isAnonimo ? 'ANÃ“NIMO' : 'IDENTIFICADO') }}</span>
						<span class="badge small" *ngIf="r.ultimaPrioridad === 'nuevo'">nuevo</span>
					</div>
					<button class="btn btn-outline">Ver Detalle</button>
				</div>

				<div class="report-main">
							<div class="report-left">
								<h3 class="report-title">{{ getZonaName(r) }}</h3>
								<div class="report-subtitle">{{ getTipoName(r) }}</div>
						<p class="report-desc">{{ r.descripcion }}</p>

						<div class="confidential-box">
							<div class="conf-title">InformaciÃ³n Confidencial del Reporter</div>
							<div class="conf-rows">
								<div class="conf-item">
									<span class="icon">
										<!-- Person icon -->
										<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
											<circle cx="12" cy="7" r="4"></circle>
											<path d="M5.5 21a6.5 6.5 0 0 1 13 0"></path>
										</svg>
									</span>
									<div class="conf-text">{{ getReporterName(r) }}</div>
								</div>
								<div class="conf-item">
									<span class="icon">
										<!-- Mail icon (updated) -->
										<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
											<rect x="2" y="5" width="20" height="14" rx="2"></rect>
											<path d="M22 7l-10 7L2 7"></path>
										</svg>
									</span>
									<div class="conf-text">{{ getReporterCorreo(r) }}</div>
								</div>
								<div class="conf-item">
									<span class="icon">
										<!-- Lock icon -->
										<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
											<rect x="3" y="11" width="18" height="11" rx="2"></rect>
											<path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
										</svg>
									</span>
									<div class="conf-text">Rol: {{ getReporterRol(r) }}</div>
								</div>
							</div>
						</div>
					</div>
							<!-- report-right removed: meta moved to footer -->
				</div>
						<div class="card-footer horizontal">
							<div class="meta-left">
								<span class="icon">
									<!-- Pin / location icon -->
									<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
										<path d="M21 10c0 7-9 13-9 13S3 17 3 10a9 9 0 0 1 18 0z"></path>
										<circle cx="12" cy="10" r="2"></circle>
									</svg>
								</span>
								{{ getZonaName(r) }}
							</div>
							<div class="meta-right">
								<span class="icon">
									<!-- Clock icon -->
									<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
										<circle cx="12" cy="12" r="10"></circle>
										<path d="M12 6v6l4 2"></path>
									</svg>
								</span>
								{{ formatDate(r.fechaCreacion) }} Â· Actualizado: {{ formatDate(r.fechaUltimaGestion || r.fechaCreacion) }}
							</div>
						</div>
			</div>
	</div>
</div>
